# repodump

A Rust CLI tool that produces an LLM-friendly text dump of a directory or git repository.  
Perfect for preparing repository content for analysis by language models. 
Respects `.gitignore` by default. Supports glob-style include/exclude/filter rules.

This script was generated by an LLM using the PROMPT.MD file as input. Therefore, it may have bugs that will be fixed over time. For a more detailed description of the script and its intended behavior, please read the PROMPT.md file.

## Install

This repository can be installed directly from GitHub with:

```sh
cargo install --git https://github.com/Priyanshu4/repodump
```

## Usage

```
repodump <path> [options]
```

By default, if `path` is not provided, repodump generates a dump of the current Git repository or directory.

### Options

| Long Option            | Short | Argument     | Description                                                                                                    | Default        |
| ---------------------- | ----- | ------------ | -------------------------------------------------------------------------------------------------------------- | -------------- |
| `--output <file>`      | `-o`  | `<file>`     | Path of the generated text file.                                                                               | `repodump.txt` |
| `--tree`               | `-t`  | none         | Include only the directory structure, omit file contents.                                                      | off            |
| `--contents`           | `-c`  | none         | Include only file contents, omit directory structure.                                                          | off            |
| `--ignore-gitignore`   | `-g`  | none         | Ignore `.gitignore` rules when selecting files.                                                                | off            |
| `--filter <patterns>`  | `-f`  | `<patterns>` | Comma-separated or repeated glob patterns. Only files matching **any** pattern are kept before exclusion step. | none           |
| `--exclude <patterns>` | `-e`  | `<patterns>` | Comma-separated or repeated glob patterns. Files matching any are excluded after filter step.                  | none           |
| `--include <patterns>` | `-i`  | `<patterns>` | Comma-separated or repeated glob patterns. Files matching any are force-included after exclusion step.         | none           |
| `--prune-tree`         | `-p`  | none         | Apply filter/exclude/include rules to the directory tree output so it matches the selected file set.           | off            |
| `--prompt <text>`      | `-m`  | `<text>`     | Append a `Prompt: <text>` block to the bottom of the generated file.                                           | none           |
| `--quiet`              | `-q`  | none         | Suppress the stdout summary of counts, output size, and token estimate.                                        | off            |

**Make sure that you use quotes around glob patterns provided as command line arguments.** If you do not use quotes, your shell may expand these globs, creating unexpected results.

### Usage examples

Dump current git repo root into default file:

```sh
repodump
```

Dump a directory and write to custom file:

```sh
repodump /path/to/project -o project_dump.txt
```

Dump only the directory tree:

```sh
repodump -t
```

Dump contents but only `.rs` and `.py` files and exclude `target/`:

```sh
repodump -c -f '*.rs' -f '*.py' -e 'target/**'
```

Force include a file that would otherwise be excluded:

```sh
repodump -c -e 'target/**' -i 'target/special.rs'
```

Prune the tree to matched files:

```sh
repodump -p -c -f '*.py'
```

Append a prompt at the end:

```sh
repodump -m "Summarize this repository for an LLM."
```

## Pattern evaluation order

Apply patterns in this exact order when deciding which files appear in the **File Contents** section:

1. **Filter** (`--filter`): Only files matching any filter remain. Files that do not match are excluded.
2. **Exclude** (`--exclude`): Files matching exclude patterns are removed. `.git/` and other always-excluded paths are always excluded here.
3. **Include** (`--include`): Files matching include patterns are re-included even if excluded earlier.

Notes:
* `.git/` is always excluded unless explicitly re-included with `--include`.
* By default the **Directory Structure** section shows the full repository tree minus `.gitignore`-excluded and always-excluded patterns. CLI `include` patterns are applied to the tree output unless `--prune-tree` is set. If `--prune-tree` is used, the tree is pruned to match the final File Contents selection (after the full filter/exclude/include process).

## Output format

1. Top of file: a human-readable directory tree. Example:

   ```
   Directory Structure:
   └── repository/
       ├── README.md
       ├── .gitignore
       └── src/
           ├── main.rs
           └── lib.rs
   ```
2. Then file contents. Each file is preceded by a header block:

   ```
   ================================================================
   FILE: src/main.rs
   ================================================================
   <file contents>

   ```

   There is a blank line between file sections.
3. If `--prompt` is provided append:

   ```
   Prompt: <USER PROVIDED TEXT>
   ```

## Stdout summary

Unless `--quiet` is set the program prints a summary like:

```
Repository: example-repository
Files in structure: 3
Files in contents: 3
Output size: 14781 bytes
Estimated tokens: 3695
```

Token estimation = `characters / 4`, rounded to nearest integer.

